let productos = [
    {
        id: "abrigo-01",
        titulo: "chaqueta acolchada",
        imagen: "../static/img/abrigos/01.jpg",
        categoria:{
            nombre:"abrigos",
            id:"abrigos"
        },
        precio:10000
    },

    {
        id: "accesorio-01",
        titulo: "Chocker Aro",
        imagen: "../static/img/Accesorios/chocker aro.jpg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-02",
        titulo: "chocker Belcebu",
        imagen: "../static/img/Accesorios/chockerBelcebu.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-03",
        titulo: "chocker Coraz칩n",
        imagen: "../static/img/Accesorios/chockerCoraz칩n.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:40000
    },
    {
        id: "accesorio-04",
        titulo: "chocker Luna",
        imagen: "../static/img/Accesorios/chockerLuna.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:30000
    },
    {
        id: "accesorio-05",
        titulo: "Chocker Puntas",
        imagen: "../static/img/Accesorios/chockerPuntas.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:40000
    },
    {
        id: "accesorio-11",
        titulo: "collar 2",
        imagen: "../static/img/Accesorios/collar2.jpg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:10000
    },
    {
        id: "accesorio-12",
        titulo: "collar calavera",
        imagen: "../static/img/Accesorios/collares calavera.jpg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:10000
    },
    {
        id: "accesorio-14",
        titulo: "medias deadpool",
        imagen: "../static/img/Accesorios/Medias deadpool.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:10000
    },
    {
        id: "accesorio-15",
        titulo: "medias IT",
        imagen: "../static/img/Accesorios/Medias IT.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:20000
    },
    {
        id: "accesorio-16",
        titulo: "medias joker",
        imagen: "../static/img/Accesorios/Medias joker.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:20000
    },
    {
        id: "accesorio-17",
        titulo: "medias llamas",
        imagen: "../static/img/Accesorios/medias llamas.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:20000
    },
    {
        id: "accesorio-18",
        titulo: "Medias Mujer maravilla",
        imagen: "../static/img/Accesorios/Medias Mujer maravilla.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:20000
    },
    {
        id: "accesorio-19",
        titulo: "Pasamonta침as negro",
        imagen: "../static/img/Accesorios/pasamonta침as negro.jpg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:20000
    },
    {
        id: "accesorio-20",
        titulo: "pocillo belcebu",
        imagen: "../static/img/Accesorios/Pocillo belcebu.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:20000
    },
    {
        id: "accesorio-21",
        titulo: "pocillo canibal",
        imagen: "../static/img/Accesorios/Pocillo canibal corpse.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-22",
        titulo: "pocillo Diseccion",
        imagen: "../static/img/Accesorios/Pocillo Diseccion.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-23",
        titulo: "pocillo hipocresy",
        imagen: "../static/img/Accesorios/Pocillo hipocresy.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:40000
    },
    {
        id: "accesorio-23",
        titulo: "pocillo Iron Maiden",
        imagen: "../static/img/Accesorios/Pocillo iron maiden.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-24",
        titulo: "pocillo King Diamond",
        imagen: "../static/img/Accesorios/Pocillo king diamond.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-25",
        titulo: "pocillo King Diamond 2",
        imagen: "../static/img/Accesorios/Pocillo king diamond2.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-27",
        titulo: "Pocillo misfits",
        imagen: "../static/img/Accesorios/pocillo misfits.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-28",
        titulo: "medias ojo de halcon",
        imagen: "../static/img/Accesorios/Pocillo Ojo de halcon.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-29",
        titulo: "pulsera de cuero amarilla",
        imagen: "../static/img/Accesorios/Pulsera de cuero amarrilla.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:50000
    },
    {
        id: "accesorio-30",
        titulo: "pulsera de cuero blanca",
        imagen: "../static/img/Accesorios/Pulsera de cuero blanca.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:45000
    },
    {
        id: "accesorio-31",
        titulo: "pulsera de cuero roja",
        imagen: "../static/img/Accesorios/Pulsera de cuero roja.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:45000
    },
    {
        id: "accesorio-32",
        titulo: "pulsera de cuero rosada",
        imagen: "../static/img/Accesorios/Pulsera de cuero roja.jpeg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:40000
    },
    {
        id: "accesorio-34",
        titulo: "vaso esqueleto",
        imagen: "../static/img/Accesorios/vaso esqueleto.jpg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:10000
    },
    {
        id: "accesorio-34",
        titulo: "vaso metalico vikingo",
        imagen: "../static/img/Accesorios/vaso metalico vikingo.jpg",
        categoria:{
            nombre:"accesorios",
            id:"accesorios"
        },
        precio:10000
    },
    {
        id: "botas-05",
        titulo: "bota cuero altas",
        imagen: "../static/img/Botas/botas de cuero altas.jpg",
        categoria:{
            nombre:"botas",
            id:"botas"
        },
        precio:80000
    },
    {
        id: "botas-06",
        titulo: "bota cuero con puntas",
        imagen: "../static/img/Botas/Botas de cuero con puntas.jpeg",
        categoria:{
            nombre:"botas",
            id:"botas"
        },
        precio:80000
    },
    {
        id: "botas-11",
        titulo: "bota mandala",
        imagen: "../static/img/Botas/Botas mandala.jpeg",
        categoria:{
            nombre:"botas",
            id:"botas"
        },
        precio:80000
    },
    {
        id: "botas-13",
        titulo: "bota escamas",
        imagen: "../static/img/Botas/Botas plataforma alta escamas.jpeg",
        categoria:{
            nombre:"botas",
            id:"botas"
        },
        precio:40000
    },

    {
        id: "botas-16",
        titulo: "bota rojizas",
        imagen: "../static/img/Botas/Botas rojizas.jpeg",
        categoria:{
            nombre:"botas",
            id:"botas"
        },
        precio:50000
    },
    {
        id: "botas-17",
        titulo: "botas verdes",
        imagen: "../static/img/Botas/Botas verdes.jpeg",
        categoria:{
            nombre:"botas",
            id:"botas"
        },
        precio:50000
    },
    {
        id: "buzos-01",
        titulo: "buzo canibal Corpse",
        imagen: "../static/img/buzos/buzo canibal Corpse.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:18000
    },
    {
        id: "abrigoss-02",
        titulo: "buzo dark funeral",
        imagen: "../static/img/buzos/buzo dark funeral.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:18000
    },
    {
        id: "buzos-03",
        titulo: "buzo Iron Maiden",
        imagen: "../static/img/buzos/buzo iron maiden.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:180000
    },
    {
        id: "buzos-04",
        titulo: "buzo Led Zepelling",
        imagen: "../static/img/buzos/buzo led zepellin.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:18000
    },
    {
        id: "buzos-05",
        titulo: "buzo morbi angels",
        imagen: "../static/img/buzos/buzo morbi angels.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:18000
    },
    {
        id: "buzos-06",
        titulo: "buzo motoshead",
        imagen: "../static/img/buzos/buzo motorhead.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:20000
    },
    {
        id: "buzos-07",
        titulo: "buzo pestilence",
        imagen: "../static/img/buzos/buzo pestilence.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:20000
    },
    {
        id: "buzos-08",
        titulo: "buzo serpiente",
        imagen: "../static/img/buzos/buzo serpiente.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:20000
    },
    {
        id: "buzos-09",
        titulo: "buzo wellcoda chivalry",
        imagen: "../static/img/buzos/buzo wellcoda chivalry.jpg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:20000
    },
    {
        id: "buzos-10",
        titulo: "buzo hoddi",
        imagen: "../static/img/buzos/hoddi.jpeg",
        categoria:{
            nombre:"buzos",
            id:"abrigos"
        },
        precio:20000
    },
    {
        id: "camisa-01",
        titulo: "buzo hoddi",
        imagen: "../static/img/camisetas-camisas/camisa de figuras.jpg",
        categoria:{
            nombre:"camisas",
            id:"camisetas"
        },
        precio:20000
    },
    {
        id: "chaqueta-01",
        titulo: "chaqueta 01",
        imagen: "../static/img/chaquetas/cha.jpeg",
        categoria:{
            nombre:"chaquetas",
            id:"chaquetas"
        },
        precio:20000
    },
    {
        id: "pantalon-01",
        titulo: "pantalon 01",
        imagen: "../static/img/pantalones/01.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-02",
        titulo: "pantalon 02",
        imagen: "../static/img/pantalones/02.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-03",
        titulo: "pantalon 03",
        imagen: "../static/img/pantalones/03.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-04",
        titulo: "pantalon 04",
        imagen: "../static/img/pantalones/04.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-05",
        titulo: "pantalon 05",
        imagen: "../static/img/pantalones/05.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-cargoNegro",
        titulo: "pantalon-cargoNegro",
        imagen: "../static/img/pantalones/pantalon cargo negro.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-cargoPantano",
        titulo: "pantalon-cargoPantano",
        imagen: "../static/img/pantalones/pantalon cargo pantano.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-Cuerina",
        titulo: "pantalon-Cuerina",
        imagen: "../static/img/pantalones/pantalon cuerina.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-negroSkinny",
        titulo: "pantalon-negroSkinny",
        imagen: "../static/img/pantalones/pantalon negro skinny.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalon-skinny",
        titulo: "pantalon-skinny",
        imagen: "../static/img/pantalones/pantalon skinny.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalones-cargo",
        titulo: "pantalones-cargo",
        imagen: "../static/img/pantalones/Pantalones cargo.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "pantalones-skinny-hombre",
        titulo: "pantalones-skinny-hombre",
        imagen: "../static/img/pantalones/pantalon skinny hombre.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "skinny-jean-hombre",
        titulo: "skinny-jean-hombre",
        imagen: "../static/img/pantalones/skinny jean hombre.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "skinny-jean-rotos",
        titulo: "skinny-jean-rotos",
        imagen: "../static/img/pantalones/skinny jean rotos.jpg",
        categoria:{
            nombre:"pantalones",
            id:"pantalones"
        },
        precio:30000
    },
    {
        id: "camisa-01",
        titulo: "Camisa polo",
        imagen: "../static/img/camisetas-camisas/camisa polo puntos.jpg",
        categoria:{
            nombre:"camisas",
            id:"camisetas"
        },
        precio:20000
    },
    {
        id: "camisa-01",
        titulo: "Camisa polo verde",
        imagen: "../static/img/camisetas-camisas/camisa polo verde.jpg",
        categoria:{
            nombre:"camisas",
            id:"camisetas"
        },
        precio:20000
    },
    {
        id: "camisa-01",
        titulo: "camiseta blanca figuras",
        imagen: "../static/img/camisetas-camisas/camiseta blanca figuras.jpg",
        categoria:{
            nombre:"camisas",
            id:"camisetas"
        },
        precio:20000
    },
    {
        id: "camisa-01",
        titulo: "camiseta ACDC",
        imagen: "../static/img/camisetas-camisas/camiseta ACDC.jpg",
        categoria:{
            nombre:"camisa naruto",
            id:"camisetas"
        },
        precio:20000
    },
    {
        id: "camisa-01",
        titulo: "camiseta kiss",
        imagen: "../static/img/camisetas-camisas/camiseta kiss.jpg",
        categoria:{
            nombre:"camisas",
            id:"camisetas"
        },
        precio:20000
    },
    {
        id: "camisa-01",
        titulo: "camiseta krowss",
        imagen: "../static/img/camisetas-camisas/camiseta krowss.jpg",
        categoria:{
            nombre:"camisas",
            id:"camisetas"
        },
        precio:20000
    },
    {
        id: "camisa-01",
        titulo: "camiseta krowss",
        imagen: "../static/img/camisetas-camisas/camiseta majin boo.jpg",
        categoria:{
            nombre:"camisas",
            id:"camisetas"
        },
        precio:20000
    },



];

fetch('http://127.0.0.1:4000/getProducts')
.then(response => response.json())
.then(productos => {
    console.log('obteniendo productos', productos);
    // cargarProductos(productos)
}).catch(error => {
    console.log('soy un error al obtener productos', error);
})


fetch("./js/productos.json")
    .then(response => response.json())
    .then(data => {
        productos = data;
        cargarProductos(productos);
    })


const contenedorProductos = document.querySelector("#contenedor-productos");
const botonesCategorias = document.querySelectorAll(".boton-categoria");
const tituloPrincipal = document.querySelector("#titulo-principal");
let botonesAgregar = document.querySelectorAll(".producto-agregar");
const numerito = document.querySelector("#numerito");


botonesCategorias.forEach(boton => boton.addEventListener("click", () => {
    aside.classList.remove("aside-visible");
}))


function cargarProductos(productosElegidos) {

    contenedorProductos.innerHTML = "";

    productosElegidos.forEach(producto => {

        const div = document.createElement("div");
        div.classList.add("producto");
        div.innerHTML = `
            <img class="producto-imagen" src="${producto.imagen}" alt="${producto.titulo}">
            <div class="producto-detalles">
                <h3 class="producto-titulo">${producto.titulo}</h3>
                <p class="producto-precio">$${producto.precio}</p>
                <button class="producto-agregar" id="${producto.id}">Agregar</button>
            </div>
        `;

        contenedorProductos.append(div);
    })

    actualizarBotonesAgregar();
}


botonesCategorias.forEach(boton => {
    boton.addEventListener("click", (e) => {

        botonesCategorias.forEach(boton => boton.classList.remove("active"));
        e.currentTarget.classList.add("active");

        if (e.currentTarget.id != "todos") {
            const productoCategoria = productos.find(producto => producto.categoria.id === e.currentTarget.id);
            tituloPrincipal.innerText = productoCategoria.categoria.nombre;
            const productosBoton = productos.filter(producto => producto.categoria.id === e.currentTarget.id);
            cargarProductos(productosBoton);
        } else {
            tituloPrincipal.innerText = "Todos los productos";
            cargarProductos(productos);
        }

    })
});

function actualizarBotonesAgregar() {
    botonesAgregar = document.querySelectorAll(".producto-agregar");

    botonesAgregar.forEach(boton => {
        boton.addEventListener("click", agregarAlCarrito);
    });
}

let productosEnCarrito;

let productosEnCarritoLS = localStorage.getItem("productos-en-carrito");

if (productosEnCarritoLS) {
    productosEnCarrito = JSON.parse(productosEnCarritoLS);
    actualizarNumerito();
} else {
    productosEnCarrito = [];
}

function agregarAlCarrito(e) {

    Toastify({
        text: "Producto agregado",
        duration: 3000,
        close: true,
        gravity: "top", // `top` or `bottom`
        position: "right", // `left`, `center` or `right`
        stopOnFocus: true, // Prevents dismissing of toast on hover
        style: {
          background: "linear-gradient(to right, #4b33a8, #785ce9)",
          borderRadius: "2rem",
          textTransform: "uppercase",
          fontSize: ".75rem"
        },
        offset: {
            x: '1.5rem', // horizontal axis - can be a number or a string indicating unity. eg: '2em'
            y: '1.5rem' // vertical axis - can be a number or a string indicating unity. eg: '2em'
          },
        onClick: function(){} // Callback after click
      }).showToast();

    const idBoton = e.currentTarget.id;
    const productoAgregado = productos.find(producto => producto.id === idBoton);

    if(productosEnCarrito.some(producto => producto.id === idBoton)) {
        const index = productosEnCarrito.findIndex(producto => producto.id === idBoton);
        productosEnCarrito[index].cantidad++;
    } else {
        productoAgregado.cantidad = 1;
        productosEnCarrito.push(productoAgregado);
    }

    actualizarNumerito();

    localStorage.setItem("productos-en-carrito", JSON.stringify(productosEnCarrito));
}

function actualizarNumerito() {
    let nuevoNumerito = productosEnCarrito.reduce((acc, producto) => acc + producto.cantidad, 0);
    numerito.innerText = nuevoNumerito;
}